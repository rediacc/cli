name: MACHINE_PRO_TEST
description: Test advanced machine operations including bridge assignment
executor: "commands/cli_main.py"
setup:
- name: create_test_company
  command:
  - CreateNewCompany
  args:
    companyName: MachineAdvCompany-${TIMESTAMP}
    email: machineadv-admin-${TIMESTAMP}@test.com
    password: ${config.test_data.company.admin_password}
  expect:
    success: true
- name: activate_user_account
  command:
  - ActivateUserAccount
  args:
    email: machineadv-admin-${TIMESTAMP}@test.com
    activationCode: ${config.test_environment.activation_code}
    password: ${config.test_data.company.admin_password}
  expect:
    success: true
- name: login_as_admin
  command:
  - CreateAuthenticationRequest
  args:
    email: machineadv-admin-${TIMESTAMP}@test.com
    password: ${config.test_data.company.admin_password}
  expect:
    success: true
- name: create_test_team
  command:
  - CreateTeam
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
    teamVault: '{}'
  expect:
    success: true
- name: create_test_region
  command:
  - CreateRegion
  args:
    regionName: AdvancedRegion-${TIMESTAMP}
    regionVault: '{}'
  expect:
    success: true
- name: create_bridge1
  command:
  - CreateBridge
  args:
    regionName: AdvancedRegion-${TIMESTAMP}
    bridgeName: Bridge1-${TIMESTAMP}
    bridgeVault: '{}'
  expect:
    success: true
- name: create_bridge2
  command:
  - CreateBridge
  args:
    regionName: AdvancedRegion-${TIMESTAMP}
    bridgeName: Bridge2-${TIMESTAMP}
    bridgeVault: '{}'
  expect:
    success: true
- name: create_test_machine
  command:
  - CreateMachine
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
    bridgeName: Bridge1-${TIMESTAMP}
    machineName: AdvancedMachine-${TIMESTAMP}
    machineVault: '{"ip": "10.0.0.1"}'
  expect:
    success: true
tests:
- name: update_machine_bridge_assignment
  command:
  - UpdateMachineAssignedBridge
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
    machineName: AdvancedMachine-${TIMESTAMP}
    newBridgeName: Bridge2-${TIMESTAMP}
  expect:
    success: true
  description: Assign machine to a different bridge
- name: update_machine_vault
  command:
  - UpdateMachineVault
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
    machineName: AdvancedMachine-${TIMESTAMP}
    machineVault: '{"ip": "10.0.0.2", "updated": true}'
    vaultVersion: 1
  expect:
    success: true
  description: Update machine vault data
- name: rename_machine
  command:
  - UpdateMachineName
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
    currentMachineName: AdvancedMachine-${TIMESTAMP}
    newMachineName: RenamedMachine-${TIMESTAMP}
  expect:
    success: true
  description: Rename the machine
- name: delete_machine
  command:
  - DeleteMachine
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
    machineName: RenamedMachine-${TIMESTAMP}
  expect:
    success: true
teardown:
- name: delete_bridge1
  command:
  - DeleteBridge
  args:
    regionName: AdvancedRegion-${TIMESTAMP}
    bridgeName: Bridge1-${TIMESTAMP}
  expect:
    success: true
- name: delete_bridge2
  command:
  - DeleteBridge
  args:
    regionName: AdvancedRegion-${TIMESTAMP}
    bridgeName: Bridge2-${TIMESTAMP}
  expect:
    success: true
- name: delete_region
  command:
  - DeleteRegion
  args:
    regionName: AdvancedRegion-${TIMESTAMP}
  expect:
    success: true
- name: delete_team
  command:
  - DeleteTeam
  args:
    teamName: AdvancedTeam-${TIMESTAMP}
  expect:
    success: true
- name: verify_cleanup_context
  command:
  - GetUserCompany
  expect:
    success: true
  description: Verify we're still authenticated before logout
- name: logout
  command:
  - logout
  expect:
    success: true
  description: Logout and invalidate authentication token
