name: "DELETION_SIMPLE_TEST"
description: "Simplified test for resource deletion endpoints"
executor: "rediacc-cli.py"

# Tests deletion endpoints with minimal setup
# Depends on company setup from earlier tests

setup:
  # Login with existing admin
  - name: "login_admin"
    command: ["login"]
    args:
      email: "${chain.admin_email}"
      password: "${chain.admin_password}"
    expect:
      success: true

tests:
  # Create minimal resources for deletion testing
  - name: "create_test_team"
    command: ["CreateTeam"]
    args:
      teamName: "DeleteTest-${TIMESTAMP}"
      teamVault: '{}'
    expect:
      success: true
  
  - name: "create_test_region"
    command: ["CreateRegion"]
    args:
      regionName: "DeleteRegion-${TIMESTAMP}"
      regionVault: '{}'
    expect:
      success: true
  
  - name: "create_test_bridge"
    command: ["CreateBridge"]
    args:
      regionName: "DeleteRegion-${TIMESTAMP}"
      bridgeName: "DeleteBridge-${TIMESTAMP}"
      bridgeVault: '{}'
    expect:
      success: true
  
  - name: "create_test_machine"
    command: ["CreateMachine"]
    args:
      teamName: "DeleteTest-${TIMESTAMP}"
      bridgeName: "DeleteBridge-${TIMESTAMP}"
      machineName: "DeleteMachine-${TIMESTAMP}"
      machineVault: '{"ip": "10.0.0.1"}'
    expect:
      success: true
  
  - name: "create_test_repository"
    command: ["CreateRepository"]
    args:
      teamName: "DeleteTest-${TIMESTAMP}"
      repoName: "DeleteRepo-${TIMESTAMP}"
      repoVault: '{}'
    expect:
      success: true
  
  # Now delete in correct order (repository -> machine -> bridge -> region -> team)
  - name: "delete_repository"
    command: ["DeleteRepository"]
    args:
      teamName: "DeleteTest-${TIMESTAMP}"
      repoName: "DeleteRepo-${TIMESTAMP}"
    expect:
      success: true
  
  - name: "delete_machine"
    command: ["DeleteMachine"]
    args:
      teamName: "DeleteTest-${TIMESTAMP}"
      machineName: "DeleteMachine-${TIMESTAMP}"
    expect:
      success: true
  
  - name: "delete_bridge"
    command: ["DeleteBridge"]
    args:
      regionName: "DeleteRegion-${TIMESTAMP}"
      bridgeName: "DeleteBridge-${TIMESTAMP}"
    expect:
      success: true
  
  - name: "delete_region"
    command: ["DeleteRegion"]
    args:
      regionName: "DeleteRegion-${TIMESTAMP}"
    expect:
      success: true
  
  - name: "delete_team"
    command: ["DeleteTeam"]
    args:
      teamName: "DeleteTest-${TIMESTAMP}"
    expect:
      success: true