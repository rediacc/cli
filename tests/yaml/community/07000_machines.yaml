name: MACHINES_TEST
description: Test machine creation, renaming, and status updates
executor: "commands/cli_main.py"
setup:
- name: create_test_company
  command:
  - CreateNewCompany
  args:
    companyName: MachinesCompany-${TIMESTAMP}
    email: machines-admin-${TIMESTAMP}@test.com
    password: ${config.test_data.company.admin_password}
  expect:
    success: true
- name: activate_user_account
  command:
  - ActivateUserAccount
  args:
    email: machines-admin-${TIMESTAMP}@test.com
    activationCode: ${config.test_environment.activation_code}
    password: ${config.test_data.company.admin_password}
  expect:
    success: true
- name: login_as_admin
  command:
  - CreateAuthenticationRequest
  args:
    email: machines-admin-${TIMESTAMP}@test.com
    password: ${config.test_data.company.admin_password}
  expect:
    success: true
tests:
- name: create_team_for_machine
  command:
  - CreateTeam
  args:
    teamName: MachineTestTeam-${TIMESTAMP}_${TEST_ID}
    teamVault: '{"SSH_PRIVATE_KEY": "test-key"}'
  expect:
    success: true
- name: create_region_for_machine
  command:
  - CreateRegion
  args:
    regionName: MachineTestRegion-${TIMESTAMP}_${TEST_ID}
    regionVault: '{"type": "test"}'
  expect:
    success: true
- name: create_bridge_for_machine
  command:
  - CreateBridge
  args:
    regionName: MachineTestRegion-${TIMESTAMP}_${TEST_ID}
    bridgeName: Updated-TestBridge-${TIMESTAMP}_${TEST_ID}
    bridgeVault: '{"access_key": "test"}'
  expect:
    success: true
- name: create_machine
  command:
  - CreateMachine
  args:
    teamName: MachineTestTeam-${TIMESTAMP}_${TEST_ID}
    bridgeName: Updated-TestBridge-${TIMESTAMP}_${TEST_ID}
    machineName: ${config.test_data.machine.name_pattern}
    machineVault: '{"ip": "10.0.0.5", "user": "rediacc", "datastore": "/mnt/datastore"}'
  expect:
    success: true
- name: update_machine_name
  command:
  - UpdateMachineName
  args:
    teamName: MachineTestTeam-${TIMESTAMP}_${TEST_ID}
    currentMachineName: ${config.test_data.machine.name_pattern}
    newMachineName: Updated-${config.test_data.machine.name_pattern}
  expect:
    success: true
- name: verify_cleanup_context
  command:
  - GetUserCompany
  expect:
    success: true
  description: Verify we're still authenticated before logout
- name: logout
  command:
  - DeleteUserRequest
  expect:
    success: true
  description: Logout and invalidate authentication token
