name: "MACHINES_TEST"
description: "Test machine creation, renaming, and status updates"
executor: "rediacc-cli.py"

# Export data to chain context for use in subsequent test files
# Note: Machine requires team and bridge to exist first
chain_export:
  test_machine_name: "${config.test_data.machine.name_pattern}"
  test_machine_team: "MachineTestTeam-${TIMESTAMP}_${TEST_ID}"

tests:
  - name: "create_team_for_machine"
    command: ["CreateTeam"]
    args:
      teamName: "MachineTestTeam-${TIMESTAMP}_${TEST_ID}"
      teamVault: "{\"SSH_PRIVATE_KEY\": \"test-key\"}"
    expect:
      success: true

  - name: "create_machine"
    command: ["CreateMachine"]
    args:
      teamName: "MachineTestTeam-${TIMESTAMP}_${TEST_ID}"
      bridgeName: "Updated-TestBridge-${TIMESTAMP}_${TEST_ID}"
      machineName: "${config.test_data.machine.name_pattern}"
      machineVault: "{\"ip\": \"10.0.0.5\", \"user\": \"rediacc\", \"datastore\": \"/mnt/datastore\"}"
    expect:
      success: true
  
  - name: "update_machine_name"
    command: ["UpdateMachineName"]
    args:
      teamName: "MachineTestTeam-${TIMESTAMP}_${TEST_ID}"
      currentMachineName: "${config.test_data.machine.name_pattern}"
      newMachineName: "Updated-${config.test_data.machine.name_pattern}"
    expect:
      success: true