name: "MACHINES_TEST"
description: "Test machine creation, renaming, and status updates"
executor: "rediacc-cli.py"

# Export data to chain context for use in subsequent test files
# Note: Machine requires team and bridge to exist first
chain_export:
  test_machine_name: "${config.test_data.machine.name_pattern}"
  test_machine_team: "MachineTestTeam-${TIMESTAMP}_${TEST_ID}"

tests:
  - name: "create_team_for_machine"
    command: ["create", "team", "MachineTestTeam-${TIMESTAMP}_${TEST_ID}"]
    args:
      vault: "{\"SSH_PRIVATE_KEY\": \"test-key\"}"
    expect:
      success: true

  - name: "create_machine"
    command: ["create", "machine", "MachineTestTeam-${TIMESTAMP}_${TEST_ID}", "Updated-TestBridge-${TIMESTAMP}_${TEST_ID}", "${config.test_data.machine.name_pattern}"]
    args:
      vault: "{\"ip\": \"10.0.0.5\", \"user\": \"rediacc\", \"datastore\": \"/mnt/datastore\"}"
    expect:
      success: true
  
  - name: "update_machine_name"
    command: ["update", "machine", "MachineTestTeam-${TIMESTAMP}_${TEST_ID}", "${config.test_data.machine.name_pattern}", "Updated-${config.test_data.machine.name_pattern}"]
    expect:
      success: true