# Test parallel operations and dependency handling
name: "Parallel Operations Test"
description: "Test creating multiple independent resources in parallel"
tags: [complex, parallel, performance]

dependencies:
  company: "TestCompany"

setup:
  - set_var: 
      team_prefix: "parallel_team"
      region_prefix: "parallel_region"

steps:
  # Create multiple teams in parallel
  - action: create
    entity: team
    params:
      name: "{{ team_prefix }}_1"
      company: "{{ company }}"
    parallel: true

  - action: create
    entity: team
    params:
      name: "{{ team_prefix }}_2"
      company: "{{ company }}"
    parallel: true

  - action: create
    entity: team
    params:
      name: "{{ team_prefix }}_3"
      company: "{{ company }}"
    parallel: true

  # Create multiple regions in parallel
  - action: create
    entity: region
    params:
      name: "{{ region_prefix }}_1"
      company: "{{ company }}"
      location: "us-east-1"
    parallel: true

  - action: create
    entity: region
    params:
      name: "{{ region_prefix }}_2"
      company: "{{ company }}"
      location: "eu-west-1"
    parallel: true

  # Create bridges for each region
  - action: create
    entity: bridge
    params:
      name: "bridge_{{ region_prefix }}_1"
      region: "{{ region_prefix }}_1"
    parallel: true

  - action: create
    entity: bridge
    params:
      name: "bridge_{{ region_prefix }}_2"
      region: "{{ region_prefix }}_2"
    parallel: true

  # Create machines using different teams and bridges
  - action: create
    entity: machine
    params:
      name: "machine_1"
      team: "{{ team_prefix }}_1"
      bridge: "bridge_{{ region_prefix }}_1"
    parallel: true

  - action: create
    entity: machine
    params:
      name: "machine_2"
      team: "{{ team_prefix }}_2"
      bridge: "bridge_{{ region_prefix }}_2"
    parallel: true

  # Verify all resources were created
  - action: verify
    entity: machine
    params:
      name: "machine_1"
    expect:
      team: "{{ team_prefix }}_1"

  - action: verify
    entity: machine
    params:
      name: "machine_2"
    expect:
      team: "{{ team_prefix }}_2"

cleanup:
  # Cleanup in dependency order
  - action: delete
    entity: machine
    params:
      name: "machine_1"
    parallel: true

  - action: delete
    entity: machine
    params:
      name: "machine_2"
    parallel: true

  - action: delete
    entity: bridge
    params:
      name: "bridge_{{ region_prefix }}_1"
    parallel: true

  - action: delete
    entity: bridge
    params:
      name: "bridge_{{ region_prefix }}_2"
    parallel: true

  - action: delete
    entity: region
    params:
      name: "{{ region_prefix }}_1"
    parallel: true

  - action: delete
    entity: region
    params:
      name: "{{ region_prefix }}_2"
    parallel: true

  - action: delete
    entity: team
    params:
      name: "{{ team_prefix }}_1"
    parallel: true

  - action: delete
    entity: team
    params:
      name: "{{ team_prefix }}_2"
    parallel: true

  - action: delete
    entity: team
    params:
      name: "{{ team_prefix }}_3"
    parallel: true